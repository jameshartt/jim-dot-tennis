<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixture Detail - Jim.Tennis Admin</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/fixture-detail.css">
    <link rel="stylesheet" href="/static/css/fixture-at-glance.css">
    <script src="https://unpkg.com/htmx.org@1.9.4"></script>
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="breadcrumb">
                <a href="/admin/league">Admin Dashboard</a> &gt; 
                {{if and .NavigationContext (eq .NavigationContext.from "team")}}
                    <a href="/admin/league/teams">Teams</a> &gt; 
                    <a href="/admin/league/teams/{{.NavigationContext.teamId}}">{{.NavigationContext.teamName}}</a> &gt; 
                    Fixture Detail
                {{else}}
                    <a href="/admin/league/fixtures">Fixtures</a> &gt; 
                    Fixture Detail
                {{end}}
            </div>
        </div>
    </header>

    <main class="admin-content">
        <div class="container">
            <div class="action-bar">
                <h2>Fixture Information</h2>
                <div class="action-buttons">
                    {{if ne .FixtureDetail.Status "Completed"}}
                        <a href="/admin/league/fixtures/{{.FixtureDetail.ID}}/edit" class="btn-edit">üìÖ Edit Schedule</a>
                    {{end}}
                    <button type="button" class="btn-share" id="share-fixture-btn"
                        data-fixture-url="/admin/league/fixtures/{{.FixtureDetail.ID}}">
                        üì§ Share
                    </button>
                    {{if and .NavigationContext (eq .NavigationContext.from "team")}}
                        <a href="/admin/league/teams/{{.NavigationContext.teamId}}" class="btn-back">‚Üê Back to {{.NavigationContext.teamName}}</a>
                    {{else}}
                        <a href="/admin/league/fixtures" class="btn-back">‚Üê Back to Fixtures</a>
                    {{end}}
                </div>
            </div>

            <div class="fixture-detail">
                <div class="fixture-header">
                    <h1 class="fixture-title">
                        {{if .FixtureDetail.Division}}{{.FixtureDetail.Division.Name}}{{else}}Division TBD{{end}}
                        {{if .FixtureDetail.Week}} - Week {{.FixtureDetail.Week.WeekNumber}}{{end}}
                    </h1>
                    <p class="teams-vs">
                        <span class="team-name">{{if .FixtureDetail.HomeTeam}}{{.FixtureDetail.HomeTeam.Name}}{{else}}TBD{{end}}</span>
                        <span class="vs-text">vs</span>
                        <span class="team-name">{{if .FixtureDetail.AwayTeam}}{{.FixtureDetail.AwayTeam.Name}}{{else}}TBD{{end}}</span>
                    </p>
                    <span class="status-badge {{.FixtureDetail.Status}}">{{.FixtureDetail.Status}}</span>
                </div>

                {{template "admin/partials/derby_management.html" .}}

                {{if .FixtureDetail.VenueClub}}
                <div class="detail-section venue-section" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--secondary-color, #2ecc71);">
                    <h3 style="margin-top: 0;">üìç Venue</h3>
                    <p style="margin: 0.25rem 0;"><strong>{{.FixtureDetail.VenueClub.Name}}</strong></p>
                    {{if .FixtureDetail.VenueClub.AddressLine1}}
                        <p style="margin: 0.25rem 0; color: #555;">{{if .FixtureDetail.VenueClub.AddressLine1}}{{deref .FixtureDetail.VenueClub.AddressLine1}}{{end}}{{if .FixtureDetail.VenueClub.AddressLine2}}, {{deref .FixtureDetail.VenueClub.AddressLine2}}{{end}}</p>
                    {{end}}
                    {{if .FixtureDetail.VenueClub.Postcode}}
                        <p style="margin: 0.25rem 0; color: #555;">{{deref .FixtureDetail.VenueClub.Postcode}}</p>
                    {{end}}
                    <div style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        {{if and .FixtureDetail.VenueClub.Latitude .FixtureDetail.VenueClub.Longitude}}
                            <a href="https://www.google.com/maps?q={{derefFloat .FixtureDetail.VenueClub.Latitude}},{{derefFloat .FixtureDetail.VenueClub.Longitude}}" target="_blank" rel="noopener" class="btn-edit" style="font-size: 0.875rem;">üó∫Ô∏è View on Map</a>
                        {{end}}
                        <a href="/admin/league/fixtures/{{.FixtureDetail.ID}}/calendar.ics" class="btn-edit" style="font-size: 0.875rem;">üìÖ Download Calendar</a>
                    </div>
                    {{if .FixtureDetail.IsVenueOverridden}}
                        <div style="margin-top: 0.75rem; padding: 0.5rem 0.75rem; background: #fff3cd; border-radius: 4px; font-size: 0.875rem;">
                            <strong>‚ö†Ô∏è Venue overridden:</strong> {{.FixtureDetail.VenueOverrideReason}}
                        </div>
                    {{end}}
                </div>
                {{end}}

                <div class="info-highlight">
                    <strong>üí° Tip:</strong> The fixture summary below is designed to look great in screenshots and can be <u>clicked to copy</u> all the details to your clipboard for easy sharing via WhatsApp, email, or other communication channels.
                </div>

                {{template "admin/partials/fixture_at_glance.html" .}}

                <div class="detail-grid">
                    {{template "admin/partials/notes_section.html" .}}
                    
                    {{if ne .FixtureDetail.Status "Completed"}}
                    <div class="detail-section matchups-section">
                        <h3>üéæ Matchups</h3>
                        
                        {{if .FixtureDetail.DuplicateWarnings}}
                        <div class="duplicate-warnings">
                            {{range .FixtureDetail.DuplicateWarnings}}
                            <div class="warning-alert">
                                <span class="warning-icon">‚ö†Ô∏è</span>
                                <strong>{{.PlayerName}}</strong> is assigned to multiple matchups: {{range $index, $matchup := .Matchups}}{{if $index}}, {{end}}{{$matchup}}{{end}}
                            </div>
                            {{end}}
                        </div>
                        {{end}}
                        
                        {{if .FixtureDetail.Matchups}}
                        <div class="matchup-summary">
                            <div class="matchup-count">
                                {{if eq .FixtureDetail.Status "Completed"}}
                                <strong>üèÜ Match Complete - {{len .FixtureDetail.Matchups}}/4 matchups played</strong>
                                {{else}}
                                <strong>{{len .FixtureDetail.Matchups}}/4 matchups configured</strong>
                                {{end}}
                            </div>
                            <div class="quick-matchup-list">
                                {{range .FixtureDetail.Matchups}}
                                <div class="quick-matchup">
                                    <span class="matchup-type-name">{{.Matchup.Type}}:</span>
                                    {{if .Players}}
                                        {{range $index, $player := .Players}}{{if $index}}, {{end}}{{if and $.FixtureDetail.DayCaptain (eq $player.Player.ID $.FixtureDetail.DayCaptain.ID)}}<strong>{{$player.Player.FirstName}} {{printf "%.1s" $player.Player.LastName}}. (C)</strong>{{else}}{{$player.Player.FirstName}} {{printf "%.1s" $player.Player.LastName}}.{{end}}{{end}}
                                    {{else}}
                                        <span class="tbd">TBD</span>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                        </div>
                        {{else}}
                        <p class="no-matchups">No matchups configured yet.</p>
                        {{end}}

                        <div class="matchup-actions">
                            {{if and .IsDerby .ManagingTeam}}
                            <a href="/admin/league/fixtures/{{.FixtureDetail.ID}}/team-selection?managingTeam={{.ManagingTeam.ID}}&teamName={{.ManagingTeam.Name}}" class="btn-matchup-selection">
                            {{else}}
                            <a href="/admin/league/fixtures/{{.FixtureDetail.ID}}/team-selection" class="btn-matchup-selection">
                            {{end}}
                                {{if .FixtureDetail.Matchups}}
                                    ‚úèÔ∏è Select Team Players
                                {{else}}
                                    üèÜ Select Team Players
                                {{end}}
                            </a>
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </main>

    <script src="/static/js/fixture-detail.js"></script>
</body>
</html> 