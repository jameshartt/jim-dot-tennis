<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Season Management - Jim.Tennis Admin</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@1.9.4"></script>
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
    <style>
        .admin-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        .breadcrumb {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .breadcrumb a {
            color: #ffffff80;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            color: white;
        }
        .admin-content {
            padding: 0 1rem;
        }
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .btn-add {
            background: var(--success-color);
            color: white;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }

        .seasons-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .seasons-table th,
        .seasons-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        .seasons-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .seasons-table tbody tr {
            transition: background-color 0.2s ease;
        }
        .seasons-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .active-badge {
            background: #28a745;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .stats-cell {
            font-size: 0.9rem;
            color: #495057;
        }

        .stats-number {
            font-weight: 600;
            color: var(--primary-color);
        }

        .btn-setup {
            background: var(--primary-color);
            color: white;
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            text-decoration: none;
            display: inline-block;
        }

        .btn-setup:hover {
            opacity: 0.9;
        }

        .btn-set-active {
            background: #6c757d;
            color: white;
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-set-active:hover {
            background: #5a6268;
        }

        .create-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group small {
            color: #6c757d;
            font-size: 0.75rem;
        }

        .no-seasons {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .seasons-table th,
            .seasons-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .stats-cell {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="breadcrumb">
                <a href="/admin/league">Admin Dashboard</a> &gt; Seasons
            </div>
            <h1>Season Management</h1>
        </div>
    </header>

    <main class="admin-content">
        <div class="container">
            <div class="action-bar">
                <h2>Seasons</h2>
                <button onclick="showCreateSeasonModal()" class="btn-add">➕ Create Season</button>
            </div>

            {{if .Seasons}}
            <div class="table-container">
                <table class="seasons-table">
                    <thead>
                        <tr>
                            <th>Season</th>
                            <th>Year</th>
                            <th>Dates</th>
                            <th>Weeks</th>
                            <th class="stats-cell">Teams</th>
                            <th class="stats-cell">Fixtures</th>
                            <th class="stats-cell">Divisions</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Seasons}}
                        <tr>
                            <td><strong>{{.Season.Name}}</strong></td>
                            <td>{{.Season.Year}}</td>
                            <td>
                                <div style="font-size: 0.85rem;">
                                    {{.Season.StartDate.Format "02 Jan"}} - {{.Season.EndDate.Format "02 Jan 2006"}}
                                </div>
                            </td>
                            <td>{{.WeekCount}}</td>
                            <td class="stats-cell">
                                {{if .Stats}}
                                <span class="stats-number">{{.Stats.TeamCount}}</span>
                                {{else}}
                                <span style="color: #999;">-</span>
                                {{end}}
                            </td>
                            <td class="stats-cell">
                                {{if .Stats}}
                                <span class="stats-number">{{.Stats.FixtureCount}}</span>
                                <small style="color: #6c757d;">({{.Stats.CompletedCount}} done)</small>
                                {{else}}
                                <span style="color: #999;">-</span>
                                {{end}}
                            </td>
                            <td class="stats-cell">
                                {{if .Stats}}
                                <span class="stats-number">{{.Stats.DivisionCount}}</span>
                                {{else}}
                                <span style="color: #999;">-</span>
                                {{end}}
                            </td>
                            <td>
                                {{if .Season.IsActive}}
                                <span class="active-badge">ACTIVE</span>
                                {{else}}
                                <span style="color: #6c757d; font-size: 0.85rem;">Inactive</span>
                                {{end}}
                            </td>
                            <td>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <a href="/admin/league/seasons/setup?id={{.Season.ID}}" class="btn-setup">⚙️ Setup</a>
                                    {{if not .Season.IsActive}}
                                    <form method="POST" action="/admin/league/seasons/set-active?id={{.Season.ID}}" style="display: inline;">
                                        <button type="submit" class="btn-set-active">Set Active</button>
                                    </form>
                                    {{end}}
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="no-seasons">
                <h3>No Seasons Found</h3>
                <p>Create your first season to get started.</p>
            </div>
            {{end}}
        </div>
    </main>

    <script>
        function showCreateSeasonModal() {
            document.getElementById('createSeasonModal').style.display = 'flex';
        }

        function hideCreateSeasonModal() {
            document.getElementById('createSeasonModal').style.display = 'none';
            document.getElementById('createSeasonForm').reset();
        }
    </script>

    <!-- Create Season Modal -->
    <div id="createSeasonModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Create New Season</h2>
                <button onclick="hideCreateSeasonModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>

            <form id="createSeasonForm" method="POST" action="/admin/league/seasons">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Season Name:</label>
                        <input type="text" id="name" name="name" required placeholder="e.g., 2026 Season">
                    </div>
                    <div class="form-group">
                        <label for="year">Year:</label>
                        <input type="number" id="year" name="year" required value="{{.CurrentYear}}">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="start_date">Start Date:</label>
                        <input type="date" id="start_date" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label for="end_date">End Date:</label>
                        <input type="date" id="end_date" name="end_date" required>
                    </div>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="num_weeks">Number of Weeks:</label>
                    <input type="number" id="num_weeks" name="num_weeks" required value="18" min="1" max="52">
                    <small>Typically 18 weeks for a standard season</small>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="hideCreateSeasonModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">Create Season</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>
